# ============================================================================
# Plasten Project - Geometry Layers Configuration
# ============================================================================
# 
# This file defines the layer processing pipeline for the Plasten AgriPV project.
# 
# Key Concepts:
# - Geltungsbereich: Legal planning boundary (follows AgriPV outline)
# - AgriPV: Solar planning designation zone
# - Baugrenze: Construction boundary (where panels actually go)
# - Dead Zones: AgriPV areas excluded from Baugrenze due to buffers
#
# Processing Flow:
# 1. Load input shapefiles
# 2. Define boundaries (Flur, Gemarkung, Gemeinde, Parcel)
# 3. Calculate Hard Exclusions (Wald, Biotopes)
# 4. Calculate Soft Exclusions (utilities, buildings, roads, trees)
# 5. Calculate Geltungsbereich Base from parcels
# 6. Calculate AgriPV (expands 20m into soft exclusions)
# 7. Final Geltungsbereich (follows AgriPV outline)
# 8. Calculate Baugrenze (20m inset from AgriPV, minus buffer zones)
# 9. Apply hatching/styling
# 10. Generate infrastructure layers
#
# ============================================================================

geomLayers:

  # ==========================================================================
  # SECTION 1: INPUT SHAPEFILES - Raw data sources
  # ==========================================================================

  # --------------------------------------------------------------------------
  # Administrative Boundaries
  # --------------------------------------------------------------------------

  - name: Nutzungsartengrenze
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/nutzungsartengrenze5_pl.shp"
    close: true
    # sync: push

  - name: Flur
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/flur.shp"
    label: flurname
    close: true
    linetypeScale: 0.2
    linetypeGeneration: true
    style: flurgrenze
    sync: push
    viewports:
      - name: WorkView
        style: flurWorkView

  - name: Gemarkung
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/gemarkung.shp"
    label: gmkname
    close: true
    linetypeGeneration: true
    style: gemarkungsgrenze
    sync: push
    viewports:
      - name: WorkView
        style: gemarkungWorkView

  - name: Gemeinde
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/gemeinde.shp"
    label: gen
    close: true
    linetypeGeneration: true
    style: gemeindegrenze
    sync: push
    viewports:
      - name: WorkView
        style: gemeindeWorkView

  - name: Parcel
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/parcel.shp"
    label: label
    close: true
    style: parcel
    viewports:
      - name: WorkView
        style: parcelWorkView

  # --------------------------------------------------------------------------
  # Hard Exclusions - Features that exclude BOTH AgriPV and Baugrenze
  # --------------------------------------------------------------------------

  - name: Wald
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/wald.shp"
    close: true
    sync: push
    viewports:
      - name: WorkView
        style: waldWorkView
    operations:
      - type: dissolve

  - name: Moor
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/Moor.shp"
    close: true
    sync: push
    operations:
      - type: dissolve

  - name: Biotope Input
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/biotope.shp"

  - name: Geschütze Biotope
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/gesch_biotope.shp"
    style:
      layer:
        plot: false

  # Combined biotope layer (both types merged)
  - name: Biotope
    style:
      layer:
        plot: false
    viewports:
      - name: WorkView
        style: biotopWorkView
    operations:
      - type: dissolve
        layers:
          - Biotope Input
          - Geschütze Biotope

  # --------------------------------------------------------------------------
  # Soft Exclusion Inputs - Features that only exclude Baugrenze (not AgriPV)
  # --------------------------------------------------------------------------

  - name: Einzelbaumlinie
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/baum_abstand.shp"

  - name: Straßenflurstückskante
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/straßenflürstückskante.shp"

  - name: FG_Unterirdisch
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/FG_Unterirdisch.shp"
    sync: push

  # Raw input containing complete FG data (both oberirdisch and unterirdisch)
  - name: FG_Oberirdisch Input
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/FG_Oberirdisch.shp"

  # Buffer mask to subtract underground sections from complete FG
  - name: FG_Unterirdisch Buffer Mask
    operations:
      - type: buffer
        layers:
          - FG_Unterirdisch
        distance: 1
        capStyle: flat  # Critical: no extension beyond line endpoints
        joinStyle: round
        quadSegs: 16

  # Corrected oberirdisch layer: complete FG minus underground sections
  - name: FG_Oberirdisch
    sync: push
    operations:
      - type: copy
        layers:
          - FG_Oberirdisch Input
      - type: difference
        layers:
          - FG_Unterirdisch Buffer Mask
        reverseDifference: false

  - name: Ontras_FG_buffer_4
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/Ontras_FG_buffer_4.shp"
    style:
      layer:
        color: "orange"
        plot: false

  - name: Ontras_FG_buffer_2
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/Ontras_FG_buffer_2.shp"
    style:
      layer:
        color: "orange"
        plot: false

  - name: Gebäude 150m Abstand
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/gebäude_150m_abstand.shp"

  # --------------------------------------------------------------------------
  # Manual Exclusions
  # --------------------------------------------------------------------------

  # - name: Exclude Baufeld
  #   shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/Exclude Baufeld.shp"

  # - name: Exclude Baugrenze
  #   shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/Exclude Baugrenze.shp"

  - name: Exclude Geltungsbereich
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/Exclude Geltungsbereich.shp"

  # --------------------------------------------------------------------------
  # Manual Inclusions
  # --------------------------------------------------------------------------

  - name: Include AgriPV
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/Include AgriPV.shp"
    close: true

  # --------------------------------------------------------------------------
  # Infrastructure Inputs
  # --------------------------------------------------------------------------

  - name: Blendschutzzaun Input
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/blendschutzzaun.shp"

  - name: Einfahrt Line Reference
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/einfahrt_line.shp"

  - name: EinAusfahrt Line Input
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/einausfahrt_line.shp"

  # ==========================================================================
  # SECTION 2: BUFFER CALCULATIONS - Baugrenze Exclusion Zones
  # ==========================================================================
  # These buffers create dead zones within AgriPV where Baugrenze cannot be placed.
  # AgriPV extends to these features, but Baugrenze must maintain buffer distances.

  # --------------------------------------------------------------------------
  # Wald Buffers: 10m for AgriPV exclusion, 30m for Baugrenze buffer zone
  # --------------------------------------------------------------------------

  # 10m buffer: AgriPV must stay this far from Wald
  - name: Wald 10m Buffer
    operations:
      - type: buffer
        layers:
          - Wald
        distance: 10
        joinStyle: round  # Use round joins to maintain true 10m distance at corners
        capStyle: round
        quadSegs: 32

  # 30m buffer: Used for Baugrenze calculation (creates 20m dead zone in AgriPV)
  - name: Waldabstand
    operations:
      - type: buffer
        layers:
          - Wald
        distance: 30
        joinStyle: round
        capStyle: round
        quadSegs: 32

  # --------------------------------------------------------------------------
  # Tree Line Buffer: 20m
  # --------------------------------------------------------------------------

  - name: Einzelbaumlinie Buffer
    operations:
      - type: buffer
        layers:
          - Einzelbaumlinie
        distance: 20
        joinStyle: round
        quadSegs: 32

  # --------------------------------------------------------------------------
  # Road Edge Buffer: 20m
  # --------------------------------------------------------------------------

  - name: Straßenflurstückskante Buffer
    operations:
      - type: buffer
        layers:
          - Straßenflurstückskante
        distance: 20
        joinStyle: round
        quadSegs: 32

  # --------------------------------------------------------------------------
  # FG Utility Line: 20m buffer (±40m total)
  # --------------------------------------------------------------------------

  - name: FG Line
    operations:
      - type: merge
        layers:
          - FG_Unterirdisch
          - FG_Oberirdisch

  - name: FG Buffer
    operations:
      - type: copy
        layers:
          - FG Line
      - type: dissolve
      - type: buffer
        distance: 20
        joinStyle: round
        capStyle: round
        quadSegs: 32

  # --------------------------------------------------------------------------
  # Gas Lines: Variable buffers (4m and 2m)
  # --------------------------------------------------------------------------

  - name: Gastrasse
    sync: push
    operations:
      - type: copy
        layers:
          - Ontras_FG_buffer_2
          - Ontras_FG_buffer_4

  - name: Ontras_FG_buffer_4 Buffer
    operations:
      - type: buffer
        layers:
          - Ontras_FG_buffer_4
        distance: 4
        joinStyle: round
        capStyle: round
        quadSegs: 32

  - name: Ontras_FG_buffer_2 Buffer
    operations:
      - type: buffer
        layers:
          - Ontras_FG_buffer_2
        distance: 2
        joinStyle: round
        capStyle: round
        quadSegs: 32

  - name: Gastrasse Buffer
    operations:
      - type: copy
        layers:
          - Ontras_FG_buffer_4 Buffer
          - Ontras_FG_buffer_2 Buffer
      - type: dissolve

  # --------------------------------------------------------------------------
  # Building Buffer: 150m
  # --------------------------------------------------------------------------

  - name: Gebäude Buffer
    operations:
      - type: buffer
        layers:
          - Gebäude 150m Abstand
        distance: 150
        joinStyle: round
        capStyle: round
        quadSegs: 32

  # ==========================================================================
  # SECTION 3: EXCLUSION ZONE AGGREGATION
  # ==========================================================================

  # --------------------------------------------------------------------------
  # Hard Exclusions: Areas where AgriPV can NEVER be
  # Includes Wald + 10m gap and Biotope
  # Note: Biotope creates holes in AgriPV/Baugrenze, but these holes are filled in Geltungsbereich
  # Note: Moor is now a soft exclusion (allows AgriPV but not Baugrenze)
  # --------------------------------------------------------------------------

  - name: Hard Exclusions
    operations:
      - type: copy
        layers:
          - Wald 10m Buffer
          - Biotope
          # - Exclude Baufeld
          - Exclude Geltungsbereich
      - type: dissolve

  # --------------------------------------------------------------------------
  # Baugrenze Exclusions: Buffer zones that Baugrenze must avoid
  # Note: Waldabstand NOT included - the 10m gap + 20m inset = 30m from forest already
  # Note: Moor added as soft exclusion (0m buffer - Baugrenze stops at edge)
  # --------------------------------------------------------------------------

  - name: Baugrenze Exclusions
    operations:
      - type: copy
        layers:
          - FG Buffer
          - Gastrasse Buffer
          - Gebäude Buffer
          - Einzelbaumlinie Buffer
          - Straßenflurstückskante Buffer
          - Moor
      - type: dissolve

  # ==========================================================================
  # SECTION 4: GELTUNGSBEREICH BASE - Calculated from parcels
  # ==========================================================================
  # These are temporary "Base" versions used for filtering/intersection.
  # The FINAL Geltungsbereich follows AgriPV outline (calculated later).

  # --------------------------------------------------------------------------
  # Geltungsbereich NW Base: Parcels 1,2,4,6,7,14 (Flur 1, Groß Plasten)
  # --------------------------------------------------------------------------

  - name: Geltungsbereich NW Base
    style: geltungsbereich
    operations:
      - type: copy
        layers:
          - name: Parcel
            values:
              - "1"
              - "2"
              - "4"
              - "6"
              - "7"
              - "14"
      - type: filterByIntersection
        layers:
          - name: Flur
            values:
              - "Flur 1"
          - name: Gemarkung
            values:
              - "Groß Plasten"
          - name: Gemeinde
            values:
              - "Groß Plasten"
      - type: dissolve

  # --------------------------------------------------------------------------
  # Geltungsbereich NO Base: Parcels 24/8, 24/9 (Flur 1, Groß Plasten)
  # --------------------------------------------------------------------------

  - name: Geltungsbereich NO Base
    style: geltungsbereich
    close: true
    operations:
      - type: copy
        layers:
          - name: Parcel
            values:
              - "24/8"
              - "24/9"
      - type: filterByIntersection
        layers:
          - name: Flur
            values:
              - "Flur 1"
          - name: Gemarkung
            values:
              - "Groß Plasten"
          - name: Gemeinde
            values:
              - "Groß Plasten"
      - type: dissolve

  # --------------------------------------------------------------------------
  # Geltungsbereich S Base: Parcel 41/1 (Flur 2, Klein Plasten)
  # --------------------------------------------------------------------------

  - name: Geltungsbereich S Base
    style: geltungsbereich
    close: true
    operations:
      - type: copy
        layers:
          - name: Parcel
            values:
              - "41/1"
      - type: filterByIntersection
        layers:
          - name: Flur
            values:
              - "Flur 2"
          - name: Gemarkung
            values:
              - "Klein Plasten"
          - name: Gemeinde
            values:
              - "Groß Plasten"
      - type: dissolve

  # ==========================================================================
  # SECTION 5: AGRIPV CALCULATION
  # ==========================================================================
  # AgriPV = (Parcels - Hard Exclusions) → -20m round → +20m bevel → constrain to 20m from Baugrenze
  # The -20/+20 buffer trick ensures Baugrenze can reach all areas of AgriPV
  # while maintaining geometric character with chamfered corners.
  # Finally, AgriPV is trimmed to ensure it's always within 20m of Baugrenze.

  # --------------------------------------------------------------------------
  # AgriPV Base: Initial solar planning zone (before 20m constraint)
  # --------------------------------------------------------------------------

  - name: AgriPV Base Unclipped
    operations:
      # Start with all parcels
      - type: copy
        layers:
          - Geltungsbereich NW Base
          - Geltungsbereich NO Base
          - Geltungsbereich S Base
      # Remove hard exclusions (Wald+10m, Biotope, manual exclusions)
      # Note: Biotope holes will be filled later at Geltungsbereich level
      - type: difference
        layers:
          - Hard Exclusions
        reverseDifference: false
      # Buffer trick: -20m (round) then +20m (bevel) to shape AgriPV
      # This ensures Baugrenze can reach all areas, while keeping geometric character
      - type: buffer
        distance: -20
        joinStyle: round
        quadSegs: 32
      - type: buffer
        distance: 20
        joinStyle: bevel  # Bevel keeps it geometric with chamfered corners, not rounded
      # Clean up small artifacts
      - type: filterGeometry
        minArea: 200
        geometryTypes:
          - Polygon

  # --------------------------------------------------------------------------
  # AgriPV Base Region Split: Clip NO region with Nutzungsartengrenze
  # --------------------------------------------------------------------------

  # Extract and clip the NO region (intersects with Nutzungsartengrenze)
  - name: AgriPV Base NO Region Clipped
    operations:
      - type: copy
        layers:
          - AgriPV Base Unclipped
      - type: intersection
        layers:
          - Geltungsbereich NO Base
      - type: intersection
        layers:
          - Nutzungsartengrenze

  # Extract NW and S regions (unclipped)
  - name: AgriPV Base Other Regions
    operations:
      - type: copy
        layers:
          - AgriPV Base Unclipped
      - type: intersection
        layers:
          - Geltungsbereich NW Base
          - Geltungsbereich S Base

  # Merge clipped NO + unclipped other regions
  - name: AgriPV Base
    operations:
      - type: merge
        layers:
          - AgriPV Base NO Region Clipped
          - AgriPV Base Other Regions

  # ==========================================================================
  # SECTION 6: BAUGRENZE CALCULATION
  # ==========================================================================
  # Baugrenze = AgriPV Base - 20m inset, then subtract ALL Baugrenze exclusion zones

  - name: Baugrenze
    sync: push
    style: baugrenze
    linetypeScale: 0.5
    linetypeGeneration: true
    close: true
    operations:
      # Start with -20m inset from AgriPV Base (which already has NO region clipped)
      - type: buffer
        layers:
          - AgriPV Base
        distance: -20
        joinStyle: round  # Round maintains true 20m distance at all corners
        quadSegs: 32
      # Subtract ALL Baugrenze exclusion zones (utilities, roads, trees, buildings, Moor)
      - type: difference
        layers:
          - Baugrenze Exclusions
          # - Exclude Baugrenze
        reverseDifference: false

  - name: Baugrenze 2
    sync: push
    style: baugrenze_2
    close: true
    operations:
      - type: buffer
        layers:
          - Baugrenze
        distance: -0.4
        joinStyle: mitre

  # --------------------------------------------------------------------------
  # AgriPV 20m Constraint: Trim AgriPV to ensure 20m distance to Baugrenze
  # --------------------------------------------------------------------------

  # Buffer Baugrenze by +20m to create the valid AgriPV envelope
  - name: Baugrenze 20m Envelope
    operations:
      - type: buffer
        layers:
          - Baugrenze
        distance: 20
        joinStyle: mitre  # Sharp corners to maintain AgriPV's geometric character

  # Final AgriPV: Constrained to be within 20m of Baugrenze
  # Note: Include AgriPV areas are merged in to override the 20m rule
  - name: AgriPV
    close: true
    sync: push
    viewports:
      - name: WorkView
        style: agripv
    operations:
      - type: copy
        layers:
          - AgriPV Base
      # Trim to areas within 20m of Baugrenze
      - type: intersection
        layers:
          - Baugrenze 20m Envelope
      # Stage 1: Remove degenerate spikes (zero-width, edge goes out and back on same path)
      - type: removeDegenerateSpikes
        tolerance: 0.01              # Merge vertices closer than 1cm
        simplifyTolerance: 0.05      # Simplify with 5cm tolerance
        minSpikeLength: 0.1          # Remove spikes thinner than 10cm
      # Stage 2: Remove thin protrusions
      - type: removeProtrusions
        bufferDistance: 0.5
        minProtrusionLength: 1.0
      # Stage 3: Remove slivers (thin features < 0.4m wide)
      - type: removeSliversErosion
        erosionDistance: 0.2
      # Stage 4: Final repair and cleanup
      - type: repair
        minArea: 20
        removeEmptyGeometries: true
        removeFailures: true
      # Override 20m rule: Add manual inclusion areas
      - type: merge
        layers:
          - Include AgriPV
      - type: dissolve

  # ==========================================================================
  # SECTION 7: FINAL GELTUNGSBEREICH - Follows AgriPV outline
  # ==========================================================================

  - name: Geltungsbereich NW
    sync: push
    style: geltungsbereich
    operations:
      - type: copy
        layers:
          - AgriPV
      - type: intersection
        layers:
          - Geltungsbereich NW Base
      # Remove interior rings (holes) caused by Biotope exclusions
      # Geltungsbereich should have a clean boundary without internal holes
      - type: removeInteriorRings
      # Stage 1: Remove degenerate spikes (zero-width, edge goes out and back on same path)
      - type: removeDegenerateSpikes
        tolerance: 0.01              # Merge vertices closer than 1cm
        simplifyTolerance: 0.05      # Simplify with 5cm tolerance
        minSpikeLength: 0.1          # Remove spikes thinner than 10cm
      # Stage 2: Remove thin protrusions
      - type: removeProtrusions
        bufferDistance: 0.5
        minProtrusionLength: 1.0
      # Stage 3: Remove slivers (thin features < 0.4m wide)
      - type: removeSliversErosion
        erosionDistance: 0.2
      # Stage 4: Final repair and cleanup
      - type: repair
        minArea: 20
        removeEmptyGeometries: true
        removeFailures: true

  - name: Geltungsbereich NO
    sync: push
    style: geltungsbereich
    operations:
      - type: copy
        layers:
          - AgriPV
      - type: intersection
        layers:
          - Geltungsbereich NO Base
      # Remove interior rings (holes) caused by Biotope exclusions
      # Geltungsbereich should have a clean boundary without internal holes
      - type: removeInteriorRings
      # Stage 1: Remove degenerate spikes (zero-width, edge goes out and back on same path)
      - type: removeDegenerateSpikes
        tolerance: 0.01              # Merge vertices closer than 1cm
        simplifyTolerance: 0.05      # Simplify with 5cm tolerance
        minSpikeLength: 0.1          # Remove spikes thinner than 10cm
      # Stage 2: Remove thin protrusions
      - type: removeProtrusions
        bufferDistance: 0.5
        minProtrusionLength: 1.0
      # Stage 3: Remove slivers (thin features < 0.4m wide)
      - type: removeSliversErosion
        erosionDistance: 0.2
      # Stage 4: Final repair and cleanup
      - type: repair
        minArea: 20
        removeEmptyGeometries: true
        removeFailures: true

  - name: Geltungsbereich S
    sync: push
    style: geltungsbereich
    operations:
      - type: copy
        layers:
          - AgriPV
      - type: intersection
        layers:
          - Geltungsbereich S Base
      # Remove interior rings (holes) caused by Biotope exclusions
      # Geltungsbereich should have a clean boundary without internal holes
      - type: removeInteriorRings
      # Stage 1: Remove degenerate spikes (zero-width, edge goes out and back on same path)
      - type: removeDegenerateSpikes
        tolerance: 0.01              # Merge vertices closer than 1cm
        simplifyTolerance: 0.05      # Simplify with 5cm tolerance
        minSpikeLength: 0.1          # Remove spikes thinner than 10cm
      # Stage 2: Remove thin protrusions
      - type: removeProtrusions
        bufferDistance: 0.5
        minProtrusionLength: 1.0
      # Stage 3: Remove slivers (thin features < 0.4m wide)
      - type: removeSliversErosion
        erosionDistance: 0.2
      # Stage 4: Final repair and cleanup
      - type: repair
        minArea: 20
        removeEmptyGeometries: true
        removeFailures: true

  # --------------------------------------------------------------------------
  # Geltungsbereich +2m Styling Variants
  # --------------------------------------------------------------------------

  - name: Geltungsbereich NW 2
    sync: push
    linetypeScale: 1
    style: geltungsbereich_2
    operations:
      - type: buffer
        layers:
          - Geltungsbereich NW
        distance: 2
        joinStyle: mitre

  - name: Geltungsbereich NO 2
    sync: push
    linetypeScale: 1
    style: geltungsbereich_2
    operations:
      - type: buffer
        layers:
          - Geltungsbereich NO
        distance: 2
        joinStyle: mitre

  - name: Geltungsbereich S 2
    sync: push
    linetypeScale: 1
    style: geltungsbereich_2
    operations:
      - type: buffer
        layers:
          - Geltungsbereich S
        distance: 2
        joinStyle: mitre

  # ==========================================================================
  # SECTION 8: HATCHING LAYERS
  # ==========================================================================

  - name: Wald Schraffur
    sync: push
    style: wald
    viewports:
      - name: WorkView
        style: waldWorkView
    applyHatch:
      layers:
        - Wald

  - name: AgriPV Schraffur Solid
    sync: push
    style: agripvSolid
    applyHatch:
      layers:
        - AgriPV

  - name: AgriPV Schraffur Lines
    sync: push
    style: agripvLines
    applyHatch:
      layers:
        - AgriPV

  # ==========================================================================
  # SECTION 9: INFRASTRUCTURE LAYERS
  # ==========================================================================

  # - name: Blendschutzzaun
  #   shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/blendschutzzaun.shp"
  #   style: blendschutzzaun
  #   sync: push

  - name: EinAusfahrt Line
    # sync: push
    style:
      layer:
        color: "magenta"
        lineweight: 50
        plot: false
    type: "line"
    shapeFile: "Öffentlich Planungsbüro Schulz/Projekte/23-24 Maxsolar - Plasten/GIS/input/einausfahrt_line.shp"

  # ==========================================================================
  # SECTION 10: BIOTOPE OUTPUT
  # ==========================================================================

  # Base biotope within Geltungsbereich
  - name: Biotope Innerhalb Geltungsbereich
    operations:
      - type: copy
        layers:
          - Geschütze Biotope
      - type: intersection
        layers:
          - Geltungsbereich NW
          - Geltungsbereich NO
          - Geltungsbereich S

  # Inner biotope area (inset by 3m from boundary)
  - name: Geschütze Biotope Innenfläche
    sync: push
    viewports:
      - name: WorkView
        style: biotopWorkView
    operations:
      - type: buffer
        layers:
          - Biotope Innerhalb Geltungsbereich
        distance: -3
        joinStyle: round

  # Solid hatching for inner biotope area
  - name: Geschütze Biotope Innenfläche Schraffur
    sync: push
    style: grünfläche
    applyHatch:
      layers:
        - Geschütze Biotope Innenfläche

  # Outer ring (3m wide border inside the biotope boundary)
  - name: Geschütze Biotope Umgrenzung
    sync: push
    operations:
      - type: copy
        layers:
          - Biotope Innerhalb Geltungsbereich
      - type: difference
        layers:
          - Geschütze Biotope Innenfläche
        reverseDifference: false

  # T-symbol hatching for the outer ring
  - name: Geschütze Biotope Umgrenzung Schraffur
    sync: push
    style: schutzflächeumgrenzung
    applyHatch:
      layers:
        - Geschütze Biotope Umgrenzung

  # Biotope outline with special linetype
  - name: Geschütze Biotope 2
    sync: push
    linetypeGeneration: true
    style: gesGeschuetzesBiotop
    operations:
      - type: buffer
        layers:
          - Geschütze Biotope
        distance: 0.5
        joinStyle: mitre

